---
title: "WWie lassen sich die Ergebnisse einer Mehrebenregression berichten?"
subtitle: "Videoserie Mehrebenenregression Teil 6/6"
author: "Dr. Uwe Remer"
date: "Juli 2022"
output:
  html_document:
    toc: yes
    number_sections: yes
    toc_depth: 2
    toc_float:
      collapsed: true
    df_print: paged
    highlight: tango
    theme: spacelab
---

```{r setup, include=FALSE}
# Figure size in inches
w = 5
h = 2.5
s = 2.8
    
knitr::opts_chunk$set(eval=TRUE, echo = TRUE, message = FALSE, warning = FALSE,
                      fig.width=w, fig.height=h, fig.align='center')
save <-  F
save_fig <- function(filename, save = TRUE){
  if(save==TRUE){
    ggsave(paste0("./Grafiken/", filename), 
         width = w, height = h,
         #scale = s,       
         unit = "in")
  }
  else{
    message("Saving skipped...")
  }
}

options(scipen=999, digits=3)
```

```{css, eval=F, echo=F}
/* CSS Stil für Formeln unter Scatterplots */
P.math {
    text-align: center;
    font-size: 2vw;
}

P.math_left {
    text-align: left;
    font-size: 1.5vw;
}


DIV.border {
    padding:9.5px;
    border-radius:4px;
    border:1px solid #cccccc;
    margin-top: 10px;
    margin-bottom:10px;
}
```


# Themenüberblick

Hallo und herzlich Willkommen zum sechsten Teil der Videoserie zum Thema Mehrebenenregression in R. 
 
In diesem Video beschäftigen wir uns mit der Frage: Wie lassen sich die Ergebnisse einer Mehrebenregression berichten?

In den vergangenen Videos haben wir nacheinander verschiedene Varianten des Mehrebenenmodells geschätzt und interpretiert. Mithilfe der Anova haben wir geprüft, ob die aufeinander aufbauenden Modelle jeweils besser an die Daten angepast ist.

In diesem Video wird es darum gehen, wie man die Ergebnisse dieser Modelle berichtet und wie man die relevanten Quantites of Interest grafisch aufbereitet.

Die konkreten Lernziele sind, dass Sie mit R in der Lage sind...

- die Regressionsergebnisse tabellarisch gegenüberzustellen.
- die fixed Effects als Forrestplot grafisch darzustellen.
- die variierenden Intercepts und variierende Slopes grafisch darzustellen.
- Cross-Level Interaktionen mit Effekt-Plots grafisch darzustellen.


Dazu wechseln wir nun zu R.


# Vorbereitung der Daten und Modelle

Wie auch schon zuvor, müssen wir das komplette RScript aus dem vorigen Video 5 mit der `source()`-Funktion ausühren, um die Daten zu laden (`RScript_mreg5.R`). 

```{r}
source("./RScript_mreg5.R") #Pfad zur Datei ggf. anpassen
```


# Tabellen zu den Regressionsmodellen

Um die Ergebnisse der Regressionen tabellarisch aufzubereiten nutzen wir die das `texreg`-Paket.

Das Paket enthält mehrere Funktionen, um die Ergebnisse unterschiedlicher Regressionsmodelle automatisch aufzubereiten und als Tabelle auszugeben.

Dabei unterscheiden sich die Funktionen, je nach dem, in welchem Format die Tabellen formatiert werden sollen:

- `screenreg()` gibt die Tabelle auf dem Bildschirm in der RConsole aus.
- `htmlreg()` erstellt die Taeblle im html-Format
- `texreg()` gibt die Tabelle im Latex Format aus.
- `wordreg()` erstellt die Tabelle in einem Microsoft Word Format


```{r, results='asis'}
library(texreg)
screenreg(list(mreg3,mreg4))
htmlreg(list(mreg3,mreg4))
texreg(list(mreg3,mreg4))
wordreg(list(mreg3,mreg4)),
        file = "tabelle.doc")
```

Alternativ kann man die `tab_model()`-Funktion aus dem `sjPlot`-Paket nutzen. Auch diese Funktion erstellt für unterschiedlichste Regressionsmodelle die passenden Tabellen. Zudem lassen sich die Tabellen sehr kleinteilig den eigenen Bedürfnissen anpassen. 

Hilfe und Erläuterungen gibt es auch in der Vignette zum Paket: https://strengejacke.github.io/sjPlot/articles/tab_mixed.html   

```{r sjt_tabellen, results='asis'}
library(sjPlot)
?tab_model
# Gibt Tabdelleim RStudio Viewe 
tab_model(mreg3,mreg4, 
           p.style = "stars",
          use.viewer = F)

# Oder man kann die Tabelle in einer Datei speichern
tab_model(mreg3,mreg4, 
           p.style = "stars",
          use.viewer = F,
          file = "tabelle.html")
```


# Fixed Effects grafisch darstellen

```{r grafiken_1}
sjPlot::plot_model(mreg4,
                   show.values=T)
sjPlot::plot_model(mreg4, type="re", sort.est = "bildung")
sjPlot::plot_model(mreg4, type="int")

```


# Aufgabe

- Stellen Sie zu Ihrer eigenen Fragestellung die Regressionsergebnisse der verschiedenen Modelle vergleichend als Tabelle dar.

- Bereiten Sie die Quantites of Interest der Mehrebenenmodelle (Variierende Intercepts, variierende Slopes, Cross-Level Interaktionseffekte) grafisch auf. 

#	Lernzielabgleich

Haben Sie alles mitgenommen? Fragen Sie sich selbst, ob Sie die folgenden Lernziele erreicht haben: 


- die Regressionsergebnisse tabellarisch gegenüberzustellen.
- die fixed Effects als Forrestplot grafisch darzustellen.
- die variierenden Intercepts und variierende Slopes grafisch darzustellen.
- Cross-Level Interaktionen mit Effekt-Plots grafisch darzustellen.

```{r, echo=F, eval=F}
library("knitr")
knitr::purl("Mreg5.Rmd",
            documentation=0)
```
